import{d as z,r as x,g as U,c as v,a as s,b as $,e as N,w as q,v as A,u as o,i as H,t as S,f as K,h as Q,F as W,j as X,o as g,n as V}from"./index-hRCHVk7D.js";import{V as Y,_ as Z}from"./VirtualTree-DU9pTDWB.js";import{u as ee}from"./useDemoTree-Ct-pWdhJ.js";import"./treeData-5pDBKKP_.js";const te={class:"demo-section"},ne={class:"control-panel"},se={class:"control-label"},ae={key:0,class:"node-count-info"},le={class:"tree-container"},oe={class:"tree-shell"},ie={class:"custom-tree-loading"},re={key:0,class:"drag-loading-content"},de={key:1,class:"initial-loading-content"},ce={key:0,class:"drag-log"},ue=z({__name:"DraggableDemo",setup(ve){const{treeData:k,isLoading:T,nodeCount:p,totalNodeCount:w,regenerateData:b,handleCountChange:C,handleDataGenerated:E}=ee({initialCount:5e3}),D=x([]),r=x([]),d=x(!1);U(k,t=>{D.value=JSON.parse(JSON.stringify(t))},{immediate:!0,deep:!0});const f=t=>{const e=new Date().toLocaleTimeString();r.value.unshift(`[${e}] ${t}`),r.value.length>20&&(r.value=r.value.slice(0,20))},M=()=>{r.value=[]},B=()=>{b(),r.value=[]},O=(t,e)=>{f(`开始拖拽节点: ${t.label||t.id}`),console.log("Drag start:",t)},G=(t,e,n)=>{f(`进入节点: ${n.label||n.id}`),console.log("Drag enter:",{draggingNode:t,node:n})},P=(t,e,n)=>{f(`离开节点: ${n.label||n.id}`),console.log("Drag leave:",{draggingNode:t,node:n})},F=(t,e,n)=>{console.log("Drag over:",{draggingNode:t,node:n})},I=(t,e)=>{f(`结束拖拽: ${t.label||t.id}`),console.log("Drag end:",t)},h=(t,e,n=null)=>{var c;for(let l=0;l<t.length;l++){const a=t[l];if(a.id===e)return{node:a,parent:n,siblings:t,index:l};if((c=a.children)!=null&&c.length){const i=h(a.children,e,a);if(i)return i}}return null},J=(t,e)=>{const n=h(t,e);return n?(n.siblings.splice(n.index,1),n):null},y=(t,e)=>{const n=t.children||[];for(const c of n)if(c.id===e||y(c,e))return!0;return!1},R=async(t,e,n,c)=>{d.value=!0,await V(),await new Promise(l=>setTimeout(l,0));try{const l={prev:"之前",inner:"内部",next:"之后"};if(f(`放置节点: ${t.label||t.id} -> ${e.label||e.id} (${l[n]})`),console.log("Node dropped:",{draggingNode:t,dropNode:e,dropType:n}),t.id===e.id){d.value=!1;return}if(y(t,e.id)){f("无法将节点放置到其自身的子节点位置"),d.value=!1;return}const a=[...D.value],i=J(a,t.id);if(!i){d.value=!1;return}const u=h(a,e.id);if(!u){d.value=!1;return}const L=(m,_)=>{const j=m?m.children=m.children||[]:a;i.parent&&m&&i.parent.id===m.id&&i.index<_&&(_-=1),j.splice(_,0,i.node)};n==="inner"?(u.node.children=u.node.children||[],u.node.children.push(i.node)):n==="prev"?L(u.parent,u.index):n==="next"&&L(u.parent,u.index+1),D.value=[...a],k.value=[...a],await V()}finally{await new Promise(l=>setTimeout(l,50)),d.value=!1}};return(t,e)=>(g(),v("div",te,[e[7]||(e[7]=s("h2",null,"可拖拽",-1)),e[8]||(e[8]=s("div",{class:"info-box"},[s("p",null,[s("strong",null,"说明："),N("拖拽节点可以重新排序，支持拖拽到节点前、节点内、节点后三种位置")])],-1)),s("div",ne,[s("label",se,[e[3]||(e[3]=N(" 节点数量： ",-1)),q(s("input",{type:"number",min:"1000",step:"1000","onUpdate:modelValue":e[0]||(e[0]=n=>H(p)?p.value=n:null),onChange:e[1]||(e[1]=(...n)=>o(C)&&o(C)(...n))},null,544),[[A,o(p),void 0,{number:!0}]])]),s("button",{class:"btn",onClick:e[2]||(e[2]=(...n)=>o(b)&&o(b)(...n))},"重新生成"),s("button",{onClick:B,class:"btn btn-secondary"},"重置拖拽数据"),o(w)>0?(g(),v("span",ae,"总节点数："+S(o(w).toLocaleString()),1)):$("",!0)]),s("div",le,[s("div",oe,[K(o(Y),{data:D.value,loading:o(T)||d.value,class:"tree-scroll",draggable:"",onNodeDragStart:O,onNodeDragEnter:G,onNodeDragLeave:P,onNodeDragOver:F,onNodeDragEnd:I,onNodeDrop:R,onNodeGenerated:o(E)},{"tree-loading":Q(()=>[s("div",ie,[d.value?(g(),v("div",re,[...e[4]||(e[4]=[s("div",{class:"loading-spinner"},[s("div",{class:"spinner-dot"}),s("div",{class:"spinner-dot"}),s("div",{class:"spinner-dot"})],-1),s("p",{class:"loading-text"},"正在重组节点数据...",-1),s("p",{class:"loading-subtitle"},"拖拽操作处理中",-1)])])):(g(),v("div",de,[...e[5]||(e[5]=[s("div",{class:"loading-spinner"},[s("div",{class:"spinner-dot"}),s("div",{class:"spinner-dot"}),s("div",{class:"spinner-dot"})],-1),s("p",{class:"loading-text"},"正在加载树形数据...",-1),s("p",{class:"loading-subtitle"},"请稍候",-1)])]))])]),_:1},8,["data","loading","onNodeGenerated"])])]),r.value.length>0?(g(),v("div",ce,[e[6]||(e[6]=s("h3",null,"拖拽日志：",-1)),(g(!0),v(W,null,X(r.value,(n,c)=>(g(),v("div",{class:"log-item",key:c},S(n),1))),128)),s("button",{onClick:M,class:"btn btn-small"},"清空日志")])):$("",!0)]))}}),pe=Z(ue,[["__scopeId","data-v-74186bdf"]]);export{pe as default};
